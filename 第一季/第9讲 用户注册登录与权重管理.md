# 第9讲 用户注册登录与权重管理

tags: bcrypt Express中间件

[TOC]

## 项目

本讲所涉及项目为第4讲创建的项目

[示例项目:CarShopDemoV1](https://github.com/qingfeng365/CarShopDemoV1)

本节内容为05-work分支

## 前端页面引入`holderjs`

`holderjs` 是生成占位图片的工具，用来做测试页面和演示页面非常方便。

在项目根目录命令窗口：

```bash
bower install holderjs
```

修改`server/views/include`目录下的 `foot.jade`

增加一行:

```jade
script(src="/bower_components/holderjs/holder.min.js")
```

## 注册与登录的路由规划


<table>
    <tr>
        <th>
            用途
        </th>
        <th>
            路由
        </th>
        <th>
            模板
        </th>        
    </tr>
    <tr>
        <td>
            注册
        </td>
        <td>
            GET /signup
        </td>
        <td>
            signup.jade
        </td>        
    </tr>
    <tr>
        <td>
            注册 post
        </td>
        <td>
            POST /signup
        </td>
        <td>
        </td>          
    </tr>
    <tr>
        <td>
            登录
        </td>
        <td>
            GET /signin
        </td>
        <td>
            signin.jade
        </td>        
    </tr>
    <tr>
        <td>
            登录 post
        </td>
        <td>
            POST /signin
        </td>
        <td>
        </td>          
    </tr>  
    <tr>
        <td>
            登出 
        </td>
        <td>
            GET /logout
        </td>
        <td>
        </td>          
    </tr>      
</table>


## 模板增加菜单

修改 `server` 目录下的 `app.js` :

增加一行:

```js
app.locals.appTitle = '汽车商城';
```

修改 `server/views/include` 目录下的 `header.jade`，内容如下：

```jade
.container
	.row.m-a-md
		nav.navbar.navbar-dark.bg-primary
			a.navbar-brand(href="/")
				img(src="holder.js/100x30?theme=sky&text=#{appTitle}")
			ul.nav.   navbar-nav
				li.nav-item.active
					a.nav-link(href='/admin/car/list') 列表
			ul.nav.navbar-nav.pull-right
				li.nav-item
					a.nav-link(href="/signin") 登录
				li.nav-item
					span.nav-link |
				li.nav-item
					a.nav-link(href="/signup") 注册
```

## 增加注册模板

在 `server/views/pages` 目录下新增 `signup.jade`

```jade
extends ../layout

block content
	.container
		.row
			.col-md-4.col-md-offset-2
				form(method="POST", action="/signup")
					.form-group.row
						label.form-control-label.col-sm-2 用户名称
						.col-sm-10
							input.form-control(type="text",
								name="user[name]",placeholder="请输入用户名称",required)
					.form-group.row
						label.form-control-label.col-sm-2 密码
						.col-sm-10
							input.form-control(type="password",
								name="user[password]",placeholder="请输入密码",required)
					.form-group.row
						.col-sm-10.col-sm-offset-2
							button.btn.btn-primary(type="submit") 提交		
```

## 增加user的controller

在 `server/controllers` 目录下新增 `user.js`

```js
'use strict';

module.exports.showSignup = function(req, res, next) {
  res.render('signup', {
    title: '汽车商城 注册页',
    user: {}
  });
}
```
## 增加注册的路由处理

在 `server` 目录，修改 `routes.js`

在前面增加:

```js
var userController = require('./controllers/user');
```

以及:


```js
 app.get('/signup', userController.showSignup);
```




